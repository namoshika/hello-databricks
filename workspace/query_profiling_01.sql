-- Databricks notebook source
-- MAGIC %md
-- MAGIC # 検証用データを生成

-- COMMAND ----------

create or replace function sample_udf(prefix string, val string)
returns string return prefix || lpad(val, 10, "0")
;

-- ---------------------
-- lineitem
-- ---------------------
create or replace table lineitem_orig cluster by (orderkey_pre) as
  select "orderkey_" || lpad(l_orderkey + id, 10, "0") as orderkey_pre, *
  from delta.`dbfs:/databricks-datasets/tpch/delta-001/lineitem/`
  cross join (select (id * 100000000) as id from range(10))
;
create or replace view lineitem_view as
  select "orderkey_" || lpad(l_orderkey, 10, "0") as orderkey_clc, *
  from lineitem_orig
;

-- ---------------------
-- order_orig
-- ---------------------
create or replace table orders_orig cluster by (orderkey_pre) as
  select
    "orderkey_" || lpad(o_orderkey + id, 10, "0") as orderkey_pre,
    "filter_" || lpad(o_orderkey + id, 10, "0") as filter_pre,
    *
  from delta.`dbfs:/databricks-datasets/tpch/delta-001/orders/`
  cross join (select (id * 100000000) as id from range(10))
;
create or replace table orders_view as
  select
    "orderkey_" || lpad(o_orderkey, 10, "0") as orderkey_clc,
    "filter_" || lpad(o_orderkey, 10, "0") as filter_clc,
    *
  from orders_orig
;

analyze table lineitem_orig compute statistics for all columns;
analyze table orders_orig compute statistics for all columns;

-- COMMAND ----------

use catalog ml

-- COMMAND ----------

set use_cached_result = false;

-- COMMAND ----------

-- MAGIC %md
-- MAGIC # 検証観点
-- MAGIC 1. クエリに View が入り込むことによる影響
-- MAGIC     1. Table & Table Join
-- MAGIC     2. Table & View Join
-- MAGIC     3. View & View Join
-- MAGIC 2. 絞り込み項目による影響
-- MAGIC     1. テーブル値
-- MAGIC     2. 動的生成値
-- MAGIC 3. 絞り込み方法による影響
-- MAGIC     1. 結合
-- MAGIC     2. サブクエリ
-- MAGIC

-- COMMAND ----------

-- MAGIC %md
-- MAGIC # 1. クエリに View が入り込むことによる影響
-- MAGIC クエリにビューが含まれるかどうかは実行計画へ影響を及ぼす

-- COMMAND ----------

create or replace table output_case1_1 as
  select A.* from lineitem_orig A
  inner join orders_orig B using (orderkey_pre)
  where B.filter_pre = "filter_0016048416"
;

-- COMMAND ----------

-- MAGIC %md
-- MAGIC 実行計画
-- MAGIC
-- MAGIC ```
-- MAGIC == Optimized Logical Plan ==
-- MAGIC Project [orderkey_pre#81137, l_orderkey#81138L, l_partkey#81139L, l_suppkey#81140L, l_linenumber#81141, l_quantity#81142, l_extendedprice#81143, l_discount#81144, l_tax#81145, l_returnflag#81146, l_linestatus#81147, l_shipdate#81148, l_commitdate#81149, l_receiptdate#81150, l_shipinstruct#81151, l_shipmode#81152, l_comment#81153, id#81154L], Statistics(sizeInBytes=1800.0 B, rowCount=8, [orderkey_pre#81137 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_linenumber#81141 -> ColumnStat(distinctCount: 1, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_receiptdate#81150 -> ColumnStat(distinctCount: 1, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_extendedprice#81143 -> ColumnStat(distinctCount: 1, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_orderkey#81138L -> ColumnStat(distinctCount: 1, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipmode#81152 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), l_quantity#81142 -> ColumnStat(distinctCount: 1, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_returnflag#81146 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_discount#81144 -> ColumnStat(distinctCount: 1, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_commitdate#81149 -> ColumnStat(distinctCount: 1, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_partkey#81139L -> ColumnStat(distinctCount: 1, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_tax#81145 -> ColumnStat(distinctCount: 1, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipinstruct#81151 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_linestatus#81147 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_suppkey#81140L -> ColumnStat(distinctCount: 1, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_comment#81153 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), id#81154L -> ColumnStat(distinctCount: 1, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipdate#81148 -> ColumnStat(distinctCount: 1, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2)])
-- MAGIC +- Join Inner, (orderkey_pre#81137 = orderkey_pre#81155), rightHint=(dynamicPruningFilterId=Some(81169)), Statistics(sizeInBytes=2.0 KiB, rowCount=8, [orderkey_pre#81137 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_linenumber#81141 -> ColumnStat(distinctCount: 1, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_receiptdate#81150 -> ColumnStat(distinctCount: 1, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), orderkey_pre#81155 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_extendedprice#81143 -> ColumnStat(distinctCount: 1, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_orderkey#81138L -> ColumnStat(distinctCount: 1, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipmode#81152 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), l_quantity#81142 -> ColumnStat(distinctCount: 1, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_returnflag#81146 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_discount#81144 -> ColumnStat(distinctCount: 1, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_commitdate#81149 -> ColumnStat(distinctCount: 1, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_partkey#81139L -> ColumnStat(distinctCount: 1, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_tax#81145 -> ColumnStat(distinctCount: 1, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipinstruct#81151 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_linestatus#81147 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_suppkey#81140L -> ColumnStat(distinctCount: 1, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_comment#81153 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), id#81154L -> ColumnStat(distinctCount: 1, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipdate#81148 -> ColumnStat(distinctCount: 1, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2)])
-- MAGIC    :- Filter (isnotnull(orderkey_pre#81137) AND dynamicpruning#81170 81169), Statistics(sizeInBytes=62.9 GiB, rowCount=3.00E+8, [orderkey_pre#81137 -> ColumnStat(distinctCount: 77489466, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_linenumber#81141 -> ColumnStat(distinctCount: 7, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_receiptdate#81150 -> ColumnStat(distinctCount: 2721, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_extendedprice#81143 -> ColumnStat(distinctCount: 1106873, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_orderkey#81138L -> ColumnStat(distinctCount: 7034375, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipmode#81152 -> ColumnStat(distinctCount: 7, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), l_quantity#81142 -> ColumnStat(distinctCount: 48, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_returnflag#81146 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_discount#81144 -> ColumnStat(distinctCount: 11, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_commitdate#81149 -> ColumnStat(distinctCount: 2615, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_partkey#81139L -> ColumnStat(distinctCount: 925738, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_tax#81145 -> ColumnStat(distinctCount: 9, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipinstruct#81151 -> ColumnStat(distinctCount: 4, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_linestatus#81147 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_suppkey#81140L -> ColumnStat(distinctCount: 50113, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_comment#81153 -> ColumnStat(distinctCount: 18316269, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), id#81154L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipdate#81148 -> ColumnStat(distinctCount: 2676, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2)])
-- MAGIC    :  +- Relation ml.default.lineitem_orig[orderkey_pre#81137,l_orderkey#81138L,l_partkey#81139L,l_suppkey#81140L,l_linenumber#81141,l_quantity#81142,l_extendedprice#81143,l_discount#81144,l_tax#81145,l_returnflag#81146,l_linestatus#81147,l_shipdate#81148,l_commitdate#81149,l_receiptdate#81150,l_shipinstruct#81151,l_shipmode#81152,l_comment#81153,id#81154L] parquet, Statistics(sizeInBytes=62.9 GiB, rowCount=3.00E+8, [orderkey_pre#81137 -> ColumnStat(distinctCount: 77489466, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_linenumber#81141 -> ColumnStat(distinctCount: 7, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_receiptdate#81150 -> ColumnStat(distinctCount: 2721, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_extendedprice#81143 -> ColumnStat(distinctCount: 1106873, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_orderkey#81138L -> ColumnStat(distinctCount: 7034375, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipmode#81152 -> ColumnStat(distinctCount: 7, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), l_quantity#81142 -> ColumnStat(distinctCount: 48, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_returnflag#81146 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_discount#81144 -> ColumnStat(distinctCount: 11, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_commitdate#81149 -> ColumnStat(distinctCount: 2615, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_partkey#81139L -> ColumnStat(distinctCount: 925738, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_tax#81145 -> ColumnStat(distinctCount: 9, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipinstruct#81151 -> ColumnStat(distinctCount: 4, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_linestatus#81147 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_suppkey#81140L -> ColumnStat(distinctCount: 50113, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_comment#81153 -> ColumnStat(distinctCount: 18316269, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), id#81154L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipdate#81148 -> ColumnStat(distinctCount: 2676, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2)])
-- MAGIC    +- Project [orderkey_pre#81155], Statistics(sizeInBytes=78.0 B, rowCount=2, [orderkey_pre#81155 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2)])
-- MAGIC       +- Filter ((isnotnull(filter_pre#81156) AND isnotnull(orderkey_pre#81155)) AND (filter_pre#81156 = filter_0016048416)), Statistics(sizeInBytes=460.0 B, rowCount=2, [o_orderstatus#81159 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), o_shippriority#81164 -> ColumnStat(distinctCount: 1, min: 0, max: 0, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), o_custkey#81158L -> ColumnStat(distinctCount: 1, min: 1, max: 749999, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_totalprice#81160 -> ColumnStat(distinctCount: 1, min: 836.28, max: 569370.40, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), orderkey_pre#81155 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), o_clerk#81163 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 15, maxLen: 15, histogram: N/A, version: 2), o_orderpriority#81162 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 9, maxLen: 15, histogram: N/A, version: 2), filter_pre#81156 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 17, maxLen: 17, histogram: N/A, version: 2), id#81166L -> ColumnStat(distinctCount: 1, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_comment#81165 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 49, maxLen: 78, histogram: N/A, version: 2), o_orderkey#81157L -> ColumnStat(distinctCount: 1, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_orderdate#81161 -> ColumnStat(distinctCount: 1, min: 8035, max: 10440, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2)])
-- MAGIC          +- Relation ml.default.orders_orig[orderkey_pre#81155,filter_pre#81156,o_orderkey#81157L,o_custkey#81158L,o_orderstatus#81159,o_totalprice#81160,o_orderdate#81161,o_orderpriority#81162,o_clerk#81163,o_shippriority#81164,o_comment#81165,id#81166L] parquet, Statistics(sizeInBytes=16.1 GiB, rowCount=7.50E+7, [o_orderstatus#81159 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), o_shippriority#81164 -> ColumnStat(distinctCount: 1, min: 0, max: 0, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), o_custkey#81158L -> ColumnStat(distinctCount: 496996, min: 1, max: 749999, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_totalprice#81160 -> ColumnStat(distinctCount: 6264859, min: 836.28, max: 569370.40, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), orderkey_pre#81155 -> ColumnStat(distinctCount: 75000000, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), o_clerk#81163 -> ColumnStat(distinctCount: 4613, min: N/A, max: N/A, nullCount: 0, avgLen: 15, maxLen: 15, histogram: N/A, version: 2), o_orderpriority#81162 -> ColumnStat(distinctCount: 5, min: N/A, max: N/A, nullCount: 0, avgLen: 9, maxLen: 15, histogram: N/A, version: 2), filter_pre#81156 -> ColumnStat(distinctCount: 72374226, min: N/A, max: N/A, nullCount: 0, avgLen: 17, maxLen: 17, histogram: N/A, version: 2), id#81166L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_comment#81165 -> ColumnStat(distinctCount: 6721767, min: N/A, max: N/A, nullCount: 0, avgLen: 49, maxLen: 78, histogram: N/A, version: 2), o_orderkey#81157L -> ColumnStat(distinctCount: 7034375, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_orderdate#81161 -> ColumnStat(distinctCount: 2529, min: 8035, max: 10440, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2)])
-- MAGIC
-- MAGIC == Physical Plan ==
-- MAGIC AdaptiveSparkPlan isFinalPlan=false
-- MAGIC +- ColumnarToRow
-- MAGIC    +- PhotonResultStage
-- MAGIC       +- PhotonProject [orderkey_pre#81137, l_orderkey#81138L, l_partkey#81139L, l_suppkey#81140L, l_linenumber#81141, l_quantity#81142, l_extendedprice#81143, l_discount#81144, l_tax#81145, l_returnflag#81146, l_linestatus#81147, l_shipdate#81148, l_commitdate#81149, l_receiptdate#81150, l_shipinstruct#81151, l_shipmode#81152, l_comment#81153, id#81154L]
-- MAGIC          +- PhotonBroadcastHashJoin [orderkey_pre#81137], [orderkey_pre#81155], Inner, BuildRight, false, true
-- MAGIC             :- PhotonScan parquet ml.default.lineitem_orig[orderkey_pre#81137,l_orderkey#81138L,l_partkey#81139L,l_suppkey#81140L,l_linenumber#81141,l_quantity#81142,l_extendedprice#81143,l_discount#81144,l_tax#81145,l_returnflag#81146,l_linestatus#81147,l_shipdate#81148,l_commitdate#81149,l_receiptdate#81150,l_shipinstruct#81151,l_shipmode#81152,l_comment#81153,id#81154L] DataFilters: [isnotnull(orderkey_pre#81137), dynamicpruning#81170 81169], DictionaryFilters: [], Format: parquet, Location: PreparedDeltaFileIndex(1 paths)[s3://unity-catalogs-us-west-2/7cf139a0-c5bc-40c0-a0a7-63b7d495807..., OptionalDataFilters: [], PartitionFilters: [], ReadSchema: struct<orderkey_pre:string,l_orderkey:bigint,l_partkey:bigint,l_suppkey:bigint,l_linenumber:int,l..., RequiredDataFilters: [isnotnull(orderkey_pre#81137)]
-- MAGIC             +- PhotonShuffleExchangeSource
-- MAGIC                +- PhotonShuffleMapStage
-- MAGIC                   +- PhotonShuffleExchangeSink SinglePartition
-- MAGIC                      +- PhotonProject [orderkey_pre#81155]
-- MAGIC                         +- PhotonScan parquet ml.default.orders_orig[orderkey_pre#81155,filter_pre#81156] DataFilters: [isnotnull(filter_pre#81156), isnotnull(orderkey_pre#81155), (filter_pre#81156 = filter_0016048416)], DictionaryFilters: [(filter_pre#81156 = filter_0016048416)], Format: parquet, Location: PreparedDeltaFileIndex(1 paths)[s3://unity-catalogs-us-west-2/7cf139a0-c5bc-40c0-a0a7-63b7d495807..., OptionalDataFilters: [], PartitionFilters: [], ReadSchema: struct<orderkey_pre:string,filter_pre:string>, RequiredDataFilters: [isnotnull(filter_pre#81156), isnotnull(orderkey_pre#81155), (filter_pre#81156 = filter_0016048416)]
-- MAGIC
-- MAGIC ```

-- COMMAND ----------

create or replace table output_case1_2 as
  select A.* from lineitem_orig A
  inner join orders_view B using (orderkey_pre)
  where B.filter_pre = "filter_0016048416"
;

-- COMMAND ----------

-- MAGIC %md
-- MAGIC 実行計画
-- MAGIC
-- MAGIC ```
-- MAGIC == Optimized Logical Plan ==
-- MAGIC Project [orderkey_pre#81264, l_orderkey#81265L, l_partkey#81266L, l_suppkey#81267L, l_linenumber#81268, l_quantity#81269, l_extendedprice#81270, l_discount#81271, l_tax#81272, l_returnflag#81273, l_linestatus#81274, l_shipdate#81275, l_commitdate#81276, l_receiptdate#81277, l_shipinstruct#81278, l_shipmode#81279, l_comment#81280, id#81281L], Statistics(sizeInBytes=47.2 PiB, ColumnStat: N/A)
-- MAGIC +- Join Inner, (orderkey_pre#81264 = orderkey_pre#81284), rightHint=(dynamicPruningFilterId=Some(81298), bloomFilterJoinId=Some(11)), Statistics(sizeInBytes=51.7 PiB, ColumnStat: N/A)
-- MAGIC    :- Filter ((isnotnull(orderkey_pre#81264) AND dynamicpruning#81299 81298) AND bloomFilterPlaceholder(#11, size=1.0MB, estimatedSelectivity=0.06, pruningKey=orderkey_pre#81264, buildKey=Some(orderkey_pre#81284))), Statistics(sizeInBytes=62.9 GiB, rowCount=3.00E+8, [l_partkey#81266L -> ColumnStat(distinctCount: 925738, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipdate#81275 -> ColumnStat(distinctCount: 2676, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_quantity#81269 -> ColumnStat(distinctCount: 48, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_discount#81271 -> ColumnStat(distinctCount: 11, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_extendedprice#81270 -> ColumnStat(distinctCount: 1106873, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_linestatus#81274 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), orderkey_pre#81264 -> ColumnStat(distinctCount: 77489466, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_shipinstruct#81278 -> ColumnStat(distinctCount: 4, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_shipmode#81279 -> ColumnStat(distinctCount: 7, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), id#81281L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_tax#81272 -> ColumnStat(distinctCount: 9, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_returnflag#81273 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_suppkey#81267L -> ColumnStat(distinctCount: 50113, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_comment#81280 -> ColumnStat(distinctCount: 18316269, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), l_receiptdate#81277 -> ColumnStat(distinctCount: 2721, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_commitdate#81276 -> ColumnStat(distinctCount: 2615, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_orderkey#81265L -> ColumnStat(distinctCount: 7034375, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_linenumber#81268 -> ColumnStat(distinctCount: 7, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2)])
-- MAGIC    :  +- Relation ml.default.lineitem_orig[orderkey_pre#81264,l_orderkey#81265L,l_partkey#81266L,l_suppkey#81267L,l_linenumber#81268,l_quantity#81269,l_extendedprice#81270,l_discount#81271,l_tax#81272,l_returnflag#81273,l_linestatus#81274,l_shipdate#81275,l_commitdate#81276,l_receiptdate#81277,l_shipinstruct#81278,l_shipmode#81279,l_comment#81280,id#81281L] parquet, Statistics(sizeInBytes=62.9 GiB, rowCount=3.00E+8, [l_partkey#81266L -> ColumnStat(distinctCount: 925738, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipdate#81275 -> ColumnStat(distinctCount: 2676, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_quantity#81269 -> ColumnStat(distinctCount: 48, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_discount#81271 -> ColumnStat(distinctCount: 11, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_extendedprice#81270 -> ColumnStat(distinctCount: 1106873, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_linestatus#81274 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), orderkey_pre#81264 -> ColumnStat(distinctCount: 77489466, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_shipinstruct#81278 -> ColumnStat(distinctCount: 4, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_shipmode#81279 -> ColumnStat(distinctCount: 7, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), id#81281L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_tax#81272 -> ColumnStat(distinctCount: 9, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_returnflag#81273 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_suppkey#81267L -> ColumnStat(distinctCount: 50113, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_comment#81280 -> ColumnStat(distinctCount: 18316269, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), l_receiptdate#81277 -> ColumnStat(distinctCount: 2721, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_commitdate#81276 -> ColumnStat(distinctCount: 2615, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_orderkey#81265L -> ColumnStat(distinctCount: 7034375, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_linenumber#81268 -> ColumnStat(distinctCount: 7, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2)])
-- MAGIC    +- Project [orderkey_pre#81284], Statistics(sizeInBytes=21.0 MiB, ColumnStat: N/A)
-- MAGIC       +- Filter ((isnotnull(filter_pre#81285) AND isnotnull(orderkey_pre#81284)) AND (filter_pre#81285 = filter_0016048416)), Statistics(sizeInBytes=156.1 MiB, ColumnStat: N/A)
-- MAGIC          +- Relation ml.default.orders_view[orderkey_clc#81282,filter_clc#81283,orderkey_pre#81284,filter_pre#81285,o_orderkey#81286L,o_custkey#81287L,o_orderstatus#81288,o_totalprice#81289,o_orderdate#81290,o_orderpriority#81291,o_clerk#81292,o_shippriority#81293,o_comment#81294,id#81295L] parquet, Statistics(sizeInBytes=156.1 MiB, ColumnStat: N/A)
-- MAGIC
-- MAGIC == Physical Plan ==
-- MAGIC AdaptiveSparkPlan isFinalPlan=false
-- MAGIC +- ColumnarToRow
-- MAGIC    +- PhotonResultStage
-- MAGIC       +- PhotonProject [orderkey_pre#81264, l_orderkey#81265L, l_partkey#81266L, l_suppkey#81267L, l_linenumber#81268, l_quantity#81269, l_extendedprice#81270, l_discount#81271, l_tax#81272, l_returnflag#81273, l_linestatus#81274, l_shipdate#81275, l_commitdate#81276, l_receiptdate#81277, l_shipinstruct#81278, l_shipmode#81279, l_comment#81280, id#81281L]
-- MAGIC          +- PhotonShuffledHashJoin [orderkey_pre#81264], [orderkey_pre#81284], Inner, BuildRight
-- MAGIC             :- PhotonShuffleExchangeSource
-- MAGIC             :  +- PhotonShuffleMapStage
-- MAGIC             :     +- PhotonShuffleExchangeSink hashpartitioning(orderkey_pre#81264, 64)
-- MAGIC             :        +- PhotonScan parquet ml.default.lineitem_orig[orderkey_pre#81264,l_orderkey#81265L,l_partkey#81266L,l_suppkey#81267L,l_linenumber#81268,l_quantity#81269,l_extendedprice#81270,l_discount#81271,l_tax#81272,l_returnflag#81273,l_linestatus#81274,l_shipdate#81275,l_commitdate#81276,l_receiptdate#81277,l_shipinstruct#81278,l_shipmode#81279,l_comment#81280,id#81281L] DataFilters: [isnotnull(orderkey_pre#81264), dynamicpruning#81299 81298], DictionaryFilters: [], Format: parquet, Location: PreparedDeltaFileIndex(1 paths)[s3://unity-catalogs-us-west-2/7cf139a0-c5bc-40c0-a0a7-63b7d495807..., OptionalDataFilters: [], PartitionFilters: [], ReadSchema: struct<orderkey_pre:string,l_orderkey:bigint,l_partkey:bigint,l_suppkey:bigint,l_linenumber:int,l..., RequiredDataFilters: [isnotnull(orderkey_pre#81264)]
-- MAGIC             +- PhotonShuffleExchangeSource
-- MAGIC                +- PhotonShuffleMapStage
-- MAGIC                   +- PhotonShuffleExchangeSink hashpartitioning(orderkey_pre#81284, 64), [partial_bloom_filter_agg(bloom_expr(xxhash64(orderkey_pre#81284, 42), orderkey_pre#81284), 1, 8388608, 0, 0, 67108864) AS buf#81341]
-- MAGIC                      +- PhotonProject [orderkey_pre#81284]
-- MAGIC                         +- PhotonScan parquet ml.default.orders_view[orderkey_pre#81284,filter_pre#81285] DataFilters: [isnotnull(filter_pre#81285), isnotnull(orderkey_pre#81284), (filter_pre#81285 = filter_0016048416)], DictionaryFilters: [(filter_pre#81285 = filter_0016048416)], Format: parquet, Location: PreparedDeltaFileIndex(1 paths)[s3://unity-catalogs-us-west-2/7cf139a0-c5bc-40c0-a0a7-63b7d495807..., OptionalDataFilters: [], PartitionFilters: [], ReadSchema: struct<orderkey_pre:string,filter_pre:string>, RequiredDataFilters: [isnotnull(filter_pre#81285), isnotnull(orderkey_pre#81284), (filter_pre#81285 = filter_0016048416)]
-- MAGIC
-- MAGIC ```

-- COMMAND ----------

create or replace table output_case1_3 as
  select A.* from lineitem_view A
  inner join orders_view B using (orderkey_pre)
  where B.filter_pre = "filter_0016048416"
;

-- COMMAND ----------

-- MAGIC %md
-- MAGIC 実行計画
-- MAGIC
-- MAGIC ```
-- MAGIC == Optimized Logical Plan ==
-- MAGIC Project [orderkey_pre#81963, orderkey_clc#81912, l_orderkey#81964L, l_partkey#81965L, l_suppkey#81966L, l_linenumber#81967, l_quantity#81968, l_extendedprice#81969, l_discount#81970, l_tax#81971, l_returnflag#81972, l_linestatus#81973, l_shipdate#81974, l_commitdate#81975, l_receiptdate#81976, l_shipinstruct#81977, l_shipmode#81978, l_comment#81979, id#81980L], Statistics(sizeInBytes=51.4 PiB, ColumnStat: N/A)
-- MAGIC +- Join Inner, (orderkey_pre#81963 = orderkey_pre#81984), rightHint=(dynamicPruningFilterId=Some(81997), bloomFilterJoinId=Some(12)), Statistics(sizeInBytes=55.9 PiB, ColumnStat: N/A)
-- MAGIC    :- Project [concat(orderkey_, lpad(cast(l_orderkey#81964L as string), 10, 0)) AS orderkey_clc#81912, orderkey_pre#81963, l_orderkey#81964L, l_partkey#81965L, l_suppkey#81966L, l_linenumber#81967, l_quantity#81968, l_extendedprice#81969, l_discount#81970, l_tax#81971, l_returnflag#81972, l_linestatus#81973, l_shipdate#81974, l_commitdate#81975, l_receiptdate#81976, l_shipinstruct#81977, l_shipmode#81978, l_comment#81979, id#81980L], Statistics(sizeInBytes=68.5 GiB, rowCount=3.00E+8, [l_discount#81970 -> ColumnStat(distinctCount: 11, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_suppkey#81966L -> ColumnStat(distinctCount: 50113, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipinstruct#81977 -> ColumnStat(distinctCount: 4, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_shipdate#81974 -> ColumnStat(distinctCount: 2676, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_orderkey#81964L -> ColumnStat(distinctCount: 7034375, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_linenumber#81967 -> ColumnStat(distinctCount: 7, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_extendedprice#81969 -> ColumnStat(distinctCount: 1106873, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipmode#81978 -> ColumnStat(distinctCount: 7, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), orderkey_pre#81963 -> ColumnStat(distinctCount: 77489466, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_linestatus#81973 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), id#81980L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_quantity#81968 -> ColumnStat(distinctCount: 48, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_returnflag#81972 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_receiptdate#81976 -> ColumnStat(distinctCount: 2721, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_comment#81979 -> ColumnStat(distinctCount: 18316269, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), l_tax#81971 -> ColumnStat(distinctCount: 9, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_partkey#81965L -> ColumnStat(distinctCount: 925738, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_commitdate#81975 -> ColumnStat(distinctCount: 2615, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2)])
-- MAGIC    :  +- Filter ((isnotnull(orderkey_pre#81963) AND dynamicpruning#81998 81997) AND bloomFilterPlaceholder(#12, size=1.0MB, estimatedSelectivity=0.06, pruningKey=orderkey_pre#81963, buildKey=Some(orderkey_pre#81984))), Statistics(sizeInBytes=62.9 GiB, rowCount=3.00E+8, [l_discount#81970 -> ColumnStat(distinctCount: 11, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_suppkey#81966L -> ColumnStat(distinctCount: 50113, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipinstruct#81977 -> ColumnStat(distinctCount: 4, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_shipdate#81974 -> ColumnStat(distinctCount: 2676, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_orderkey#81964L -> ColumnStat(distinctCount: 7034375, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_linenumber#81967 -> ColumnStat(distinctCount: 7, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_extendedprice#81969 -> ColumnStat(distinctCount: 1106873, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipmode#81978 -> ColumnStat(distinctCount: 7, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), orderkey_pre#81963 -> ColumnStat(distinctCount: 77489466, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_linestatus#81973 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), id#81980L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_quantity#81968 -> ColumnStat(distinctCount: 48, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_returnflag#81972 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_receiptdate#81976 -> ColumnStat(distinctCount: 2721, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_comment#81979 -> ColumnStat(distinctCount: 18316269, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), l_tax#81971 -> ColumnStat(distinctCount: 9, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_partkey#81965L -> ColumnStat(distinctCount: 925738, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_commitdate#81975 -> ColumnStat(distinctCount: 2615, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2)])
-- MAGIC    :     +- Relation ml.default.lineitem_orig[orderkey_pre#81963,l_orderkey#81964L,l_partkey#81965L,l_suppkey#81966L,l_linenumber#81967,l_quantity#81968,l_extendedprice#81969,l_discount#81970,l_tax#81971,l_returnflag#81972,l_linestatus#81973,l_shipdate#81974,l_commitdate#81975,l_receiptdate#81976,l_shipinstruct#81977,l_shipmode#81978,l_comment#81979,id#81980L] parquet, Statistics(sizeInBytes=62.9 GiB, rowCount=3.00E+8, [l_discount#81970 -> ColumnStat(distinctCount: 11, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_suppkey#81966L -> ColumnStat(distinctCount: 50113, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipinstruct#81977 -> ColumnStat(distinctCount: 4, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_shipdate#81974 -> ColumnStat(distinctCount: 2676, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_orderkey#81964L -> ColumnStat(distinctCount: 7034375, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_linenumber#81967 -> ColumnStat(distinctCount: 7, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_extendedprice#81969 -> ColumnStat(distinctCount: 1106873, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipmode#81978 -> ColumnStat(distinctCount: 7, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), orderkey_pre#81963 -> ColumnStat(distinctCount: 77489466, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_linestatus#81973 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), id#81980L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_quantity#81968 -> ColumnStat(distinctCount: 48, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_returnflag#81972 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_receiptdate#81976 -> ColumnStat(distinctCount: 2721, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_comment#81979 -> ColumnStat(distinctCount: 18316269, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), l_tax#81971 -> ColumnStat(distinctCount: 9, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_partkey#81965L -> ColumnStat(distinctCount: 925738, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_commitdate#81975 -> ColumnStat(distinctCount: 2615, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2)])
-- MAGIC    +- Project [orderkey_pre#81984], Statistics(sizeInBytes=21.0 MiB, ColumnStat: N/A)
-- MAGIC       +- Filter ((isnotnull(filter_pre#81985) AND isnotnull(orderkey_pre#81984)) AND (filter_pre#81985 = filter_0016048416)), Statistics(sizeInBytes=156.1 MiB, ColumnStat: N/A)
-- MAGIC          +- Relation ml.default.orders_view[orderkey_clc#81982,filter_clc#81983,orderkey_pre#81984,filter_pre#81985,o_orderkey#81986L,o_custkey#81987L,o_orderstatus#81988,o_totalprice#81989,o_orderdate#81990,o_orderpriority#81991,o_clerk#81992,o_shippriority#81993,o_comment#81994,id#81995L] parquet, Statistics(sizeInBytes=156.1 MiB, ColumnStat: N/A)
-- MAGIC
-- MAGIC == Physical Plan ==
-- MAGIC AdaptiveSparkPlan isFinalPlan=false
-- MAGIC +- ColumnarToRow
-- MAGIC    +- PhotonResultStage
-- MAGIC       +- PhotonProject [orderkey_pre#81963, orderkey_clc#81912, l_orderkey#81964L, l_partkey#81965L, l_suppkey#81966L, l_linenumber#81967, l_quantity#81968, l_extendedprice#81969, l_discount#81970, l_tax#81971, l_returnflag#81972, l_linestatus#81973, l_shipdate#81974, l_commitdate#81975, l_receiptdate#81976, l_shipinstruct#81977, l_shipmode#81978, l_comment#81979, id#81980L]
-- MAGIC          +- PhotonShuffledHashJoin [orderkey_pre#81963], [orderkey_pre#81984], Inner, BuildRight
-- MAGIC             :- PhotonShuffleExchangeSource
-- MAGIC             :  +- PhotonShuffleMapStage
-- MAGIC             :     +- PhotonShuffleExchangeSink hashpartitioning(orderkey_pre#81963, 64)
-- MAGIC             :        +- PhotonProject [concat(orderkey_, lpad(cast(l_orderkey#81964L as string), 10, 0)) AS orderkey_clc#81912, orderkey_pre#81963, l_orderkey#81964L, l_partkey#81965L, l_suppkey#81966L, l_linenumber#81967, l_quantity#81968, l_extendedprice#81969, l_discount#81970, l_tax#81971, l_returnflag#81972, l_linestatus#81973, l_shipdate#81974, l_commitdate#81975, l_receiptdate#81976, l_shipinstruct#81977, l_shipmode#81978, l_comment#81979, id#81980L]
-- MAGIC             :           +- PhotonScan parquet ml.default.lineitem_orig[orderkey_pre#81963,l_orderkey#81964L,l_partkey#81965L,l_suppkey#81966L,l_linenumber#81967,l_quantity#81968,l_extendedprice#81969,l_discount#81970,l_tax#81971,l_returnflag#81972,l_linestatus#81973,l_shipdate#81974,l_commitdate#81975,l_receiptdate#81976,l_shipinstruct#81977,l_shipmode#81978,l_comment#81979,id#81980L] DataFilters: [isnotnull(orderkey_pre#81963), dynamicpruning#81998 81997], DictionaryFilters: [], Format: parquet, Location: PreparedDeltaFileIndex(1 paths)[s3://unity-catalogs-us-west-2/7cf139a0-c5bc-40c0-a0a7-63b7d495807..., OptionalDataFilters: [], PartitionFilters: [], ReadSchema: struct<orderkey_pre:string,l_orderkey:bigint,l_partkey:bigint,l_suppkey:bigint,l_linenumber:int,l..., RequiredDataFilters: [isnotnull(orderkey_pre#81963)]
-- MAGIC             +- PhotonShuffleExchangeSource
-- MAGIC                +- PhotonShuffleMapStage
-- MAGIC                   +- PhotonShuffleExchangeSink hashpartitioning(orderkey_pre#81984, 64), [partial_bloom_filter_agg(bloom_expr(xxhash64(orderkey_pre#81984, 42), orderkey_pre#81984), 1, 8388608, 0, 0, 67108864) AS buf#82042]
-- MAGIC                      +- PhotonProject [orderkey_pre#81984]
-- MAGIC                         +- PhotonScan parquet ml.default.orders_view[orderkey_pre#81984,filter_pre#81985] DataFilters: [isnotnull(filter_pre#81985), isnotnull(orderkey_pre#81984), (filter_pre#81985 = filter_0016048416)], DictionaryFilters: [(filter_pre#81985 = filter_0016048416)], Format: parquet, Location: PreparedDeltaFileIndex(1 paths)[s3://unity-catalogs-us-west-2/7cf139a0-c5bc-40c0-a0a7-63b7d495807..., OptionalDataFilters: [], PartitionFilters: [], ReadSchema: struct<orderkey_pre:string,filter_pre:string>, RequiredDataFilters: [isnotnull(filter_pre#81985), isnotnull(orderkey_pre#81984), (filter_pre#81985 = filter_0016048416)]
-- MAGIC
-- MAGIC ```

-- COMMAND ----------

-- MAGIC %md
-- MAGIC # 2. 絞り込み項目による影響
-- MAGIC 絞り込み条件に動的生成列を使うと不要データのロードがスキップされなくなる。ジョイン戦略も変わり、不要なシャッフルを誘発する (列に統計情報が無いために最適な実行計画が作成されない)

-- COMMAND ----------

create or replace table output_case2_1 as
  select A.* from lineitem_orig A
  inner join orders_orig B using (orderkey_pre)
  where B.filter_pre = "filter_0016048416"
;

-- COMMAND ----------

-- MAGIC %md
-- MAGIC 実行計画
-- MAGIC
-- MAGIC ```
-- MAGIC == Optimized Logical Plan ==
-- MAGIC Project [orderkey_pre#1120, l_orderkey#1121L, l_partkey#1122L, l_suppkey#1123L, l_linenumber#1124, l_quantity#1125, l_extendedprice#1126, l_discount#1127, l_tax#1128, l_returnflag#1129, l_linestatus#1130, l_shipdate#1131, l_commitdate#1132, l_receiptdate#1133, l_shipinstruct#1134, l_shipmode#1135, l_comment#1136, id#1137L], Statistics(sizeInBytes=1800.0 B, rowCount=8, [id#1137L -> ColumnStat(distinctCount: 1, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_discount#1127 -> ColumnStat(distinctCount: 1, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_commitdate#1132 -> ColumnStat(distinctCount: 1, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_comment#1136 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), l_suppkey#1123L -> ColumnStat(distinctCount: 1, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_tax#1128 -> ColumnStat(distinctCount: 1, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_orderkey#1121L -> ColumnStat(distinctCount: 1, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipdate#1131 -> ColumnStat(distinctCount: 1, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_shipmode#1135 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), l_quantity#1125 -> ColumnStat(distinctCount: 1, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_linenumber#1124 -> ColumnStat(distinctCount: 1, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_partkey#1122L -> ColumnStat(distinctCount: 1, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipinstruct#1134 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_linestatus#1130 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_extendedprice#1126 -> ColumnStat(distinctCount: 1, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_receiptdate#1133 -> ColumnStat(distinctCount: 1, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_returnflag#1129 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), orderkey_pre#1120 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2)])
-- MAGIC +- Join Inner, (orderkey_pre#1120 = orderkey_pre#1138), rightHint=(dynamicPruningFilterId=Some(1152)), Statistics(sizeInBytes=2.0 KiB, rowCount=8, [id#1137L -> ColumnStat(distinctCount: 1, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_discount#1127 -> ColumnStat(distinctCount: 1, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_commitdate#1132 -> ColumnStat(distinctCount: 1, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_comment#1136 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), l_suppkey#1123L -> ColumnStat(distinctCount: 1, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_tax#1128 -> ColumnStat(distinctCount: 1, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_orderkey#1121L -> ColumnStat(distinctCount: 1, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), orderkey_pre#1138 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_shipdate#1131 -> ColumnStat(distinctCount: 1, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_shipmode#1135 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), l_quantity#1125 -> ColumnStat(distinctCount: 1, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_linenumber#1124 -> ColumnStat(distinctCount: 1, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_partkey#1122L -> ColumnStat(distinctCount: 1, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipinstruct#1134 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_linestatus#1130 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_extendedprice#1126 -> ColumnStat(distinctCount: 1, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_receiptdate#1133 -> ColumnStat(distinctCount: 1, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_returnflag#1129 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), orderkey_pre#1120 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2)])
-- MAGIC    :- Filter (isnotnull(orderkey_pre#1120) AND dynamicpruning#1153 1152), Statistics(sizeInBytes=62.9 GiB, rowCount=3.00E+8, [id#1137L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_discount#1127 -> ColumnStat(distinctCount: 11, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_commitdate#1132 -> ColumnStat(distinctCount: 2615, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_comment#1136 -> ColumnStat(distinctCount: 18316269, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), l_suppkey#1123L -> ColumnStat(distinctCount: 50113, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_tax#1128 -> ColumnStat(distinctCount: 9, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_orderkey#1121L -> ColumnStat(distinctCount: 7034375, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipdate#1131 -> ColumnStat(distinctCount: 2676, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_shipmode#1135 -> ColumnStat(distinctCount: 7, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), l_quantity#1125 -> ColumnStat(distinctCount: 48, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_linenumber#1124 -> ColumnStat(distinctCount: 7, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_partkey#1122L -> ColumnStat(distinctCount: 925738, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipinstruct#1134 -> ColumnStat(distinctCount: 4, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_linestatus#1130 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_extendedprice#1126 -> ColumnStat(distinctCount: 1106873, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_receiptdate#1133 -> ColumnStat(distinctCount: 2721, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_returnflag#1129 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), orderkey_pre#1120 -> ColumnStat(distinctCount: 77489466, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2)])
-- MAGIC    :  +- Relation ml.default.lineitem_orig[orderkey_pre#1120,l_orderkey#1121L,l_partkey#1122L,l_suppkey#1123L,l_linenumber#1124,l_quantity#1125,l_extendedprice#1126,l_discount#1127,l_tax#1128,l_returnflag#1129,l_linestatus#1130,l_shipdate#1131,l_commitdate#1132,l_receiptdate#1133,l_shipinstruct#1134,l_shipmode#1135,l_comment#1136,id#1137L] parquet, Statistics(sizeInBytes=62.9 GiB, rowCount=3.00E+8, [id#1137L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_discount#1127 -> ColumnStat(distinctCount: 11, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_commitdate#1132 -> ColumnStat(distinctCount: 2615, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_comment#1136 -> ColumnStat(distinctCount: 18316269, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), l_suppkey#1123L -> ColumnStat(distinctCount: 50113, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_tax#1128 -> ColumnStat(distinctCount: 9, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_orderkey#1121L -> ColumnStat(distinctCount: 7034375, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipdate#1131 -> ColumnStat(distinctCount: 2676, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_shipmode#1135 -> ColumnStat(distinctCount: 7, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), l_quantity#1125 -> ColumnStat(distinctCount: 48, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_linenumber#1124 -> ColumnStat(distinctCount: 7, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_partkey#1122L -> ColumnStat(distinctCount: 925738, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipinstruct#1134 -> ColumnStat(distinctCount: 4, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_linestatus#1130 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_extendedprice#1126 -> ColumnStat(distinctCount: 1106873, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_receiptdate#1133 -> ColumnStat(distinctCount: 2721, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_returnflag#1129 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), orderkey_pre#1120 -> ColumnStat(distinctCount: 77489466, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2)])
-- MAGIC    +- Project [orderkey_pre#1138], Statistics(sizeInBytes=78.0 B, rowCount=2, [orderkey_pre#1138 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2)])
-- MAGIC       +- Filter ((isnotnull(filter_pre#1139) AND isnotnull(orderkey_pre#1138)) AND (filter_pre#1139 = filter_0016048416)), Statistics(sizeInBytes=460.0 B, rowCount=2, [o_orderstatus#1142 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), o_shippriority#1147 -> ColumnStat(distinctCount: 1, min: 0, max: 0, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), o_totalprice#1143 -> ColumnStat(distinctCount: 1, min: 836.28, max: 569370.40, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), orderkey_pre#1138 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), o_clerk#1146 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 15, maxLen: 15, histogram: N/A, version: 2), filter_pre#1139 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 17, maxLen: 17, histogram: N/A, version: 2), o_orderdate#1144 -> ColumnStat(distinctCount: 1, min: 8035, max: 10440, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), id#1149L -> ColumnStat(distinctCount: 1, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_orderpriority#1145 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 9, maxLen: 15, histogram: N/A, version: 2), o_custkey#1141L -> ColumnStat(distinctCount: 1, min: 1, max: 749999, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_orderkey#1140L -> ColumnStat(distinctCount: 1, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_comment#1148 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 49, maxLen: 78, histogram: N/A, version: 2)])
-- MAGIC          +- Relation ml.default.orders_orig[orderkey_pre#1138,filter_pre#1139,o_orderkey#1140L,o_custkey#1141L,o_orderstatus#1142,o_totalprice#1143,o_orderdate#1144,o_orderpriority#1145,o_clerk#1146,o_shippriority#1147,o_comment#1148,id#1149L] parquet, Statistics(sizeInBytes=16.1 GiB, rowCount=7.50E+7, [o_orderstatus#1142 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), o_shippriority#1147 -> ColumnStat(distinctCount: 1, min: 0, max: 0, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), o_totalprice#1143 -> ColumnStat(distinctCount: 6264859, min: 836.28, max: 569370.40, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), orderkey_pre#1138 -> ColumnStat(distinctCount: 75000000, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), o_clerk#1146 -> ColumnStat(distinctCount: 4613, min: N/A, max: N/A, nullCount: 0, avgLen: 15, maxLen: 15, histogram: N/A, version: 2), filter_pre#1139 -> ColumnStat(distinctCount: 72374226, min: N/A, max: N/A, nullCount: 0, avgLen: 17, maxLen: 17, histogram: N/A, version: 2), o_orderdate#1144 -> ColumnStat(distinctCount: 2529, min: 8035, max: 10440, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), id#1149L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_orderpriority#1145 -> ColumnStat(distinctCount: 5, min: N/A, max: N/A, nullCount: 0, avgLen: 9, maxLen: 15, histogram: N/A, version: 2), o_custkey#1141L -> ColumnStat(distinctCount: 496996, min: 1, max: 749999, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_orderkey#1140L -> ColumnStat(distinctCount: 7034375, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_comment#1148 -> ColumnStat(distinctCount: 6721767, min: N/A, max: N/A, nullCount: 0, avgLen: 49, maxLen: 78, histogram: N/A, version: 2)])
-- MAGIC
-- MAGIC == Physical Plan ==
-- MAGIC AdaptiveSparkPlan isFinalPlan=false
-- MAGIC +- ColumnarToRow
-- MAGIC    +- PhotonResultStage
-- MAGIC       +- PhotonProject [orderkey_pre#1120, l_orderkey#1121L, l_partkey#1122L, l_suppkey#1123L, l_linenumber#1124, l_quantity#1125, l_extendedprice#1126, l_discount#1127, l_tax#1128, l_returnflag#1129, l_linestatus#1130, l_shipdate#1131, l_commitdate#1132, l_receiptdate#1133, l_shipinstruct#1134, l_shipmode#1135, l_comment#1136, id#1137L]
-- MAGIC          +- PhotonBroadcastHashJoin [orderkey_pre#1120], [orderkey_pre#1138], Inner, BuildRight, false, true
-- MAGIC             :- PhotonScan parquet ml.default.lineitem_orig[orderkey_pre#1120,l_orderkey#1121L,l_partkey#1122L,l_suppkey#1123L,l_linenumber#1124,l_quantity#1125,l_extendedprice#1126,l_discount#1127,l_tax#1128,l_returnflag#1129,l_linestatus#1130,l_shipdate#1131,l_commitdate#1132,l_receiptdate#1133,l_shipinstruct#1134,l_shipmode#1135,l_comment#1136,id#1137L] DataFilters: [isnotnull(orderkey_pre#1120), dynamicpruning#1153 1152], DictionaryFilters: [], Format: parquet, Location: PreparedDeltaFileIndex(1 paths)[s3://unity-catalogs-us-west-2/7cf139a0-c5bc-40c0-a0a7-63b7d495807..., OptionalDataFilters: [], PartitionFilters: [], ReadSchema: struct<orderkey_pre:string,l_orderkey:bigint,l_partkey:bigint,l_suppkey:bigint,l_linenumber:int,l..., RequiredDataFilters: [isnotnull(orderkey_pre#1120)]
-- MAGIC             +- PhotonShuffleExchangeSource
-- MAGIC                +- PhotonShuffleMapStage
-- MAGIC                   +- PhotonShuffleExchangeSink SinglePartition
-- MAGIC                      +- PhotonProject [orderkey_pre#1138]
-- MAGIC                         +- PhotonScan parquet ml.default.orders_orig[orderkey_pre#1138,filter_pre#1139] DataFilters: [isnotnull(filter_pre#1139), isnotnull(orderkey_pre#1138), (filter_pre#1139 = filter_0016048416)], DictionaryFilters: [(filter_pre#1139 = filter_0016048416)], Format: parquet, Location: PreparedDeltaFileIndex(1 paths)[s3://unity-catalogs-us-west-2/7cf139a0-c5bc-40c0-a0a7-63b7d495807..., OptionalDataFilters: [], PartitionFilters: [], ReadSchema: struct<orderkey_pre:string,filter_pre:string>, RequiredDataFilters: [isnotnull(filter_pre#1139), isnotnull(orderkey_pre#1138), (filter_pre#1139 = filter_0016048416)]
-- MAGIC
-- MAGIC ```

-- COMMAND ----------

create or replace table output_case2_2 as
  select A.* from lineitem_orig A
  inner join orders_orig B using (orderkey_pre)
  where "filter_" || lpad(B.o_orderkey, 10, "0") = "filter_0016048416"
;

-- COMMAND ----------

-- MAGIC %md
-- MAGIC 実行計画
-- MAGIC
-- MAGIC ```
-- MAGIC == Optimized Logical Plan ==
-- MAGIC Project [orderkey_pre#1263, l_orderkey#1264L, l_partkey#1265L, l_suppkey#1266L, l_linenumber#1267, l_quantity#1268, l_extendedprice#1269, l_discount#1270, l_tax#1271, l_returnflag#1272, l_linestatus#1273, l_shipdate#1274, l_commitdate#1275, l_receiptdate#1276, l_shipinstruct#1277, l_shipmode#1278, l_comment#1279, id#1280L], Statistics(sizeInBytes=60.8 GiB, rowCount=2.90E+8, [l_extendedprice#1269 -> ColumnStat(distinctCount: 1071314, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_commitdate#1275 -> ColumnStat(distinctCount: 2531, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_partkey#1265L -> ColumnStat(distinctCount: 895998, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_orderkey#1264L -> ColumnStat(distinctCount: 6808386, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_comment#1279 -> ColumnStat(distinctCount: 17727832, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), l_shipdate#1274 -> ColumnStat(distinctCount: 2591, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_discount#1270 -> ColumnStat(distinctCount: 11, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), orderkey_pre#1263 -> ColumnStat(distinctCount: 75000000, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_suppkey#1266L -> ColumnStat(distinctCount: 48504, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipmode#1278 -> ColumnStat(distinctCount: 7, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), l_linestatus#1273 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_tax#1271 -> ColumnStat(distinctCount: 9, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipinstruct#1277 -> ColumnStat(distinctCount: 4, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_linenumber#1267 -> ColumnStat(distinctCount: 7, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_returnflag#1272 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_receiptdate#1276 -> ColumnStat(distinctCount: 2634, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), id#1280L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_quantity#1268 -> ColumnStat(distinctCount: 47, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2)])
-- MAGIC +- Join Inner, (orderkey_pre#1263 = orderkey_pre#1281), rightHint=(dynamicPruningFilterId=Some(1295), bloomFilterJoinId=Some(1)), Statistics(sizeInBytes=69.2 GiB, rowCount=2.90E+8, [l_extendedprice#1269 -> ColumnStat(distinctCount: 1071314, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_commitdate#1275 -> ColumnStat(distinctCount: 2531, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_partkey#1265L -> ColumnStat(distinctCount: 895998, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_orderkey#1264L -> ColumnStat(distinctCount: 6808386, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_comment#1279 -> ColumnStat(distinctCount: 17727832, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), l_shipdate#1274 -> ColumnStat(distinctCount: 2591, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), orderkey_pre#1281 -> ColumnStat(distinctCount: 75000000, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_discount#1270 -> ColumnStat(distinctCount: 11, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), orderkey_pre#1263 -> ColumnStat(distinctCount: 75000000, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_suppkey#1266L -> ColumnStat(distinctCount: 48504, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipmode#1278 -> ColumnStat(distinctCount: 7, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), l_linestatus#1273 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_tax#1271 -> ColumnStat(distinctCount: 9, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipinstruct#1277 -> ColumnStat(distinctCount: 4, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_linenumber#1267 -> ColumnStat(distinctCount: 7, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_returnflag#1272 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_receiptdate#1276 -> ColumnStat(distinctCount: 2634, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), id#1280L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_quantity#1268 -> ColumnStat(distinctCount: 47, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2)])
-- MAGIC    :- Filter ((isnotnull(orderkey_pre#1263) AND dynamicpruning#1296 1295) AND bloomFilterPlaceholder(#1, size=determined-at-runtime, estimatedSelectivity=0.35, pruningKey=orderkey_pre#1263, buildKey=Some(orderkey_pre#1281))), Statistics(sizeInBytes=62.9 GiB, rowCount=3.00E+8, [l_extendedprice#1269 -> ColumnStat(distinctCount: 1106873, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_commitdate#1275 -> ColumnStat(distinctCount: 2615, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_partkey#1265L -> ColumnStat(distinctCount: 925738, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_orderkey#1264L -> ColumnStat(distinctCount: 7034375, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_comment#1279 -> ColumnStat(distinctCount: 18316269, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), l_shipdate#1274 -> ColumnStat(distinctCount: 2676, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_discount#1270 -> ColumnStat(distinctCount: 11, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), orderkey_pre#1263 -> ColumnStat(distinctCount: 77489466, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_suppkey#1266L -> ColumnStat(distinctCount: 50113, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipmode#1278 -> ColumnStat(distinctCount: 7, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), l_linestatus#1273 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_tax#1271 -> ColumnStat(distinctCount: 9, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipinstruct#1277 -> ColumnStat(distinctCount: 4, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_linenumber#1267 -> ColumnStat(distinctCount: 7, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_returnflag#1272 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_receiptdate#1276 -> ColumnStat(distinctCount: 2721, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), id#1280L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_quantity#1268 -> ColumnStat(distinctCount: 48, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2)])
-- MAGIC    :  +- Relation ml.default.lineitem_orig[orderkey_pre#1263,l_orderkey#1264L,l_partkey#1265L,l_suppkey#1266L,l_linenumber#1267,l_quantity#1268,l_extendedprice#1269,l_discount#1270,l_tax#1271,l_returnflag#1272,l_linestatus#1273,l_shipdate#1274,l_commitdate#1275,l_receiptdate#1276,l_shipinstruct#1277,l_shipmode#1278,l_comment#1279,id#1280L] parquet, Statistics(sizeInBytes=62.9 GiB, rowCount=3.00E+8, [l_extendedprice#1269 -> ColumnStat(distinctCount: 1106873, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_commitdate#1275 -> ColumnStat(distinctCount: 2615, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_partkey#1265L -> ColumnStat(distinctCount: 925738, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_orderkey#1264L -> ColumnStat(distinctCount: 7034375, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_comment#1279 -> ColumnStat(distinctCount: 18316269, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), l_shipdate#1274 -> ColumnStat(distinctCount: 2676, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_discount#1270 -> ColumnStat(distinctCount: 11, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), orderkey_pre#1263 -> ColumnStat(distinctCount: 77489466, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_suppkey#1266L -> ColumnStat(distinctCount: 50113, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipmode#1278 -> ColumnStat(distinctCount: 7, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), l_linestatus#1273 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_tax#1271 -> ColumnStat(distinctCount: 9, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipinstruct#1277 -> ColumnStat(distinctCount: 4, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_linenumber#1267 -> ColumnStat(distinctCount: 7, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_returnflag#1272 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_receiptdate#1276 -> ColumnStat(distinctCount: 2721, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), id#1280L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_quantity#1268 -> ColumnStat(distinctCount: 48, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2)])
-- MAGIC    +- Project [orderkey_pre#1281], Statistics(sizeInBytes=2.7 GiB, rowCount=7.50E+7, [orderkey_pre#1281 -> ColumnStat(distinctCount: 75000000, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2)])
-- MAGIC       +- Filter (isnotnull(orderkey_pre#1281) AND (concat(filter_, lpad(cast(o_orderkey#1283L as string), 10, 0)) = filter_0016048416)), Statistics(sizeInBytes=16.1 GiB, rowCount=7.50E+7, [o_shippriority#1290 -> ColumnStat(distinctCount: 1, min: 0, max: 0, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), o_orderdate#1287 -> ColumnStat(distinctCount: 2529, min: 8035, max: 10440, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), o_orderkey#1283L -> ColumnStat(distinctCount: 7034375, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), orderkey_pre#1281 -> ColumnStat(distinctCount: 75000000, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), o_comment#1291 -> ColumnStat(distinctCount: 6721767, min: N/A, max: N/A, nullCount: 0, avgLen: 49, maxLen: 78, histogram: N/A, version: 2), id#1292L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_totalprice#1286 -> ColumnStat(distinctCount: 6264859, min: 836.28, max: 569370.40, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), filter_pre#1282 -> ColumnStat(distinctCount: 72374226, min: N/A, max: N/A, nullCount: 0, avgLen: 17, maxLen: 17, histogram: N/A, version: 2), o_orderstatus#1285 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), o_custkey#1284L -> ColumnStat(distinctCount: 496996, min: 1, max: 749999, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_clerk#1289 -> ColumnStat(distinctCount: 4613, min: N/A, max: N/A, nullCount: 0, avgLen: 15, maxLen: 15, histogram: N/A, version: 2), o_orderpriority#1288 -> ColumnStat(distinctCount: 5, min: N/A, max: N/A, nullCount: 0, avgLen: 9, maxLen: 15, histogram: N/A, version: 2)])
-- MAGIC          +- Relation ml.default.orders_orig[orderkey_pre#1281,filter_pre#1282,o_orderkey#1283L,o_custkey#1284L,o_orderstatus#1285,o_totalprice#1286,o_orderdate#1287,o_orderpriority#1288,o_clerk#1289,o_shippriority#1290,o_comment#1291,id#1292L] parquet, Statistics(sizeInBytes=16.1 GiB, rowCount=7.50E+7, [o_shippriority#1290 -> ColumnStat(distinctCount: 1, min: 0, max: 0, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), o_orderdate#1287 -> ColumnStat(distinctCount: 2529, min: 8035, max: 10440, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), o_orderkey#1283L -> ColumnStat(distinctCount: 7034375, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), orderkey_pre#1281 -> ColumnStat(distinctCount: 75000000, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), o_comment#1291 -> ColumnStat(distinctCount: 6721767, min: N/A, max: N/A, nullCount: 0, avgLen: 49, maxLen: 78, histogram: N/A, version: 2), id#1292L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_totalprice#1286 -> ColumnStat(distinctCount: 6264859, min: 836.28, max: 569370.40, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), filter_pre#1282 -> ColumnStat(distinctCount: 72374226, min: N/A, max: N/A, nullCount: 0, avgLen: 17, maxLen: 17, histogram: N/A, version: 2), o_orderstatus#1285 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), o_custkey#1284L -> ColumnStat(distinctCount: 496996, min: 1, max: 749999, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_clerk#1289 -> ColumnStat(distinctCount: 4613, min: N/A, max: N/A, nullCount: 0, avgLen: 15, maxLen: 15, histogram: N/A, version: 2), o_orderpriority#1288 -> ColumnStat(distinctCount: 5, min: N/A, max: N/A, nullCount: 0, avgLen: 9, maxLen: 15, histogram: N/A, version: 2)])
-- MAGIC
-- MAGIC == Physical Plan ==
-- MAGIC AdaptiveSparkPlan isFinalPlan=false
-- MAGIC +- ColumnarToRow
-- MAGIC    +- PhotonResultStage
-- MAGIC       +- PhotonProject [orderkey_pre#1263, l_orderkey#1264L, l_partkey#1265L, l_suppkey#1266L, l_linenumber#1267, l_quantity#1268, l_extendedprice#1269, l_discount#1270, l_tax#1271, l_returnflag#1272, l_linestatus#1273, l_shipdate#1274, l_commitdate#1275, l_receiptdate#1276, l_shipinstruct#1277, l_shipmode#1278, l_comment#1279, id#1280L]
-- MAGIC          +- PhotonShuffledHashJoin [orderkey_pre#1263], [orderkey_pre#1281], Inner, BuildRight
-- MAGIC             :- PhotonShuffleExchangeSource
-- MAGIC             :  +- PhotonShuffleMapStage
-- MAGIC             :     +- PhotonShuffleExchangeSink hashpartitioning(orderkey_pre#1263, 64)
-- MAGIC             :        +- PhotonScan parquet ml.default.lineitem_orig[orderkey_pre#1263,l_orderkey#1264L,l_partkey#1265L,l_suppkey#1266L,l_linenumber#1267,l_quantity#1268,l_extendedprice#1269,l_discount#1270,l_tax#1271,l_returnflag#1272,l_linestatus#1273,l_shipdate#1274,l_commitdate#1275,l_receiptdate#1276,l_shipinstruct#1277,l_shipmode#1278,l_comment#1279,id#1280L] DataFilters: [isnotnull(orderkey_pre#1263), dynamicpruning#1296 1295], DictionaryFilters: [], Format: parquet, Location: PreparedDeltaFileIndex(1 paths)[s3://unity-catalogs-us-west-2/7cf139a0-c5bc-40c0-a0a7-63b7d495807..., OptionalDataFilters: [], PartitionFilters: [], ReadSchema: struct<orderkey_pre:string,l_orderkey:bigint,l_partkey:bigint,l_suppkey:bigint,l_linenumber:int,l..., RequiredDataFilters: [isnotnull(orderkey_pre#1263)]
-- MAGIC             +- PhotonShuffleExchangeSource
-- MAGIC                +- PhotonShuffleMapStage
-- MAGIC                   +- PhotonShuffleExchangeSink hashpartitioning(orderkey_pre#1281, 64), [partial_bloom_filter_agg(bloom_expr(xxhash64(orderkey_pre#1281, 42), orderkey_pre#1281), 1, 67108864, 0, 0, 67108864) AS buf#1340]
-- MAGIC                      +- PhotonProject [orderkey_pre#1281]
-- MAGIC                         +- PhotonScan parquet ml.default.orders_orig[orderkey_pre#1281,o_orderkey#1283L] DataFilters: [isnotnull(orderkey_pre#1281), (concat(filter_, lpad(cast(o_orderkey#1283L as string), 10, 0)) = ..., DictionaryFilters: [], Format: parquet, Location: PreparedDeltaFileIndex(1 paths)[s3://unity-catalogs-us-west-2/7cf139a0-c5bc-40c0-a0a7-63b7d495807..., OptionalDataFilters: [], PartitionFilters: [], ReadSchema: struct<orderkey_pre:string,o_orderkey:bigint>, RequiredDataFilters: [isnotnull(orderkey_pre#1281), (concat(filter_, lpad(cast(o_orderkey#1283L as string), 10, 0)) = ...
-- MAGIC
-- MAGIC ```

-- COMMAND ----------

-- MAGIC %md
-- MAGIC # 3. 絞り込み方法による影響
-- MAGIC Left Semi Join が発生する (Databricks 社の人曰く、遅くなる)。物理実行計画では通常の結合に変換されている。

-- COMMAND ----------

create or replace table output_case3_1 as
  select A.* from lineitem_orig A
  inner join orders_orig B using (orderkey_pre)
  where B.filter_pre = "filter_0016048416"
;

-- COMMAND ----------

-- MAGIC %md
-- MAGIC 実行計画
-- MAGIC
-- MAGIC ```
-- MAGIC == Optimized Logical Plan ==
-- MAGIC Project [orderkey_pre#82412, l_orderkey#82413L, l_partkey#82414L, l_suppkey#82415L, l_linenumber#82416, l_quantity#82417, l_extendedprice#82418, l_discount#82419, l_tax#82420, l_returnflag#82421, l_linestatus#82422, l_shipdate#82423, l_commitdate#82424, l_receiptdate#82425, l_shipinstruct#82426, l_shipmode#82427, l_comment#82428, id#82429L], Statistics(sizeInBytes=1800.0 B, rowCount=8, [l_returnflag#82421 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_shipinstruct#82426 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_orderkey#82413L -> ColumnStat(distinctCount: 1, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_quantity#82417 -> ColumnStat(distinctCount: 1, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_linestatus#82422 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), orderkey_pre#82412 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_receiptdate#82425 -> ColumnStat(distinctCount: 1, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), id#82429L -> ColumnStat(distinctCount: 1, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_extendedprice#82418 -> ColumnStat(distinctCount: 1, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_linenumber#82416 -> ColumnStat(distinctCount: 1, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_comment#82428 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), l_shipdate#82423 -> ColumnStat(distinctCount: 1, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_discount#82419 -> ColumnStat(distinctCount: 1, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_suppkey#82415L -> ColumnStat(distinctCount: 1, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipmode#82427 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), l_commitdate#82424 -> ColumnStat(distinctCount: 1, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_partkey#82414L -> ColumnStat(distinctCount: 1, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_tax#82420 -> ColumnStat(distinctCount: 1, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2)])
-- MAGIC +- Join Inner, (orderkey_pre#82412 = orderkey_pre#82442), rightHint=(dynamicPruningFilterId=Some(82456)), Statistics(sizeInBytes=2.0 KiB, rowCount=8, [l_returnflag#82421 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_shipinstruct#82426 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_orderkey#82413L -> ColumnStat(distinctCount: 1, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_quantity#82417 -> ColumnStat(distinctCount: 1, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_linestatus#82422 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), orderkey_pre#82412 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_receiptdate#82425 -> ColumnStat(distinctCount: 1, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), orderkey_pre#82442 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), id#82429L -> ColumnStat(distinctCount: 1, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_extendedprice#82418 -> ColumnStat(distinctCount: 1, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_linenumber#82416 -> ColumnStat(distinctCount: 1, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_comment#82428 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), l_shipdate#82423 -> ColumnStat(distinctCount: 1, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_discount#82419 -> ColumnStat(distinctCount: 1, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_suppkey#82415L -> ColumnStat(distinctCount: 1, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipmode#82427 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), l_commitdate#82424 -> ColumnStat(distinctCount: 1, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_partkey#82414L -> ColumnStat(distinctCount: 1, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_tax#82420 -> ColumnStat(distinctCount: 1, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2)])
-- MAGIC    :- Filter (isnotnull(orderkey_pre#82412) AND dynamicpruning#82457 82456), Statistics(sizeInBytes=62.9 GiB, rowCount=3.00E+8, [l_returnflag#82421 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_shipinstruct#82426 -> ColumnStat(distinctCount: 4, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_orderkey#82413L -> ColumnStat(distinctCount: 7034375, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_quantity#82417 -> ColumnStat(distinctCount: 48, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_linestatus#82422 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), orderkey_pre#82412 -> ColumnStat(distinctCount: 77489466, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_receiptdate#82425 -> ColumnStat(distinctCount: 2721, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), id#82429L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_extendedprice#82418 -> ColumnStat(distinctCount: 1106873, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_linenumber#82416 -> ColumnStat(distinctCount: 7, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_comment#82428 -> ColumnStat(distinctCount: 18316269, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), l_shipdate#82423 -> ColumnStat(distinctCount: 2676, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_discount#82419 -> ColumnStat(distinctCount: 11, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_suppkey#82415L -> ColumnStat(distinctCount: 50113, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipmode#82427 -> ColumnStat(distinctCount: 7, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), l_commitdate#82424 -> ColumnStat(distinctCount: 2615, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_partkey#82414L -> ColumnStat(distinctCount: 925738, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_tax#82420 -> ColumnStat(distinctCount: 9, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2)])
-- MAGIC    :  +- Relation ml.default.lineitem_orig[orderkey_pre#82412,l_orderkey#82413L,l_partkey#82414L,l_suppkey#82415L,l_linenumber#82416,l_quantity#82417,l_extendedprice#82418,l_discount#82419,l_tax#82420,l_returnflag#82421,l_linestatus#82422,l_shipdate#82423,l_commitdate#82424,l_receiptdate#82425,l_shipinstruct#82426,l_shipmode#82427,l_comment#82428,id#82429L] parquet, Statistics(sizeInBytes=62.9 GiB, rowCount=3.00E+8, [l_returnflag#82421 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_shipinstruct#82426 -> ColumnStat(distinctCount: 4, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_orderkey#82413L -> ColumnStat(distinctCount: 7034375, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_quantity#82417 -> ColumnStat(distinctCount: 48, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_linestatus#82422 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), orderkey_pre#82412 -> ColumnStat(distinctCount: 77489466, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_receiptdate#82425 -> ColumnStat(distinctCount: 2721, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), id#82429L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_extendedprice#82418 -> ColumnStat(distinctCount: 1106873, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_linenumber#82416 -> ColumnStat(distinctCount: 7, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_comment#82428 -> ColumnStat(distinctCount: 18316269, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), l_shipdate#82423 -> ColumnStat(distinctCount: 2676, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_discount#82419 -> ColumnStat(distinctCount: 11, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_suppkey#82415L -> ColumnStat(distinctCount: 50113, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipmode#82427 -> ColumnStat(distinctCount: 7, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), l_commitdate#82424 -> ColumnStat(distinctCount: 2615, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_partkey#82414L -> ColumnStat(distinctCount: 925738, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_tax#82420 -> ColumnStat(distinctCount: 9, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2)])
-- MAGIC    +- Project [orderkey_pre#82442], Statistics(sizeInBytes=78.0 B, rowCount=2, [orderkey_pre#82442 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2)])
-- MAGIC       +- Filter ((isnotnull(filter_pre#82443) AND isnotnull(orderkey_pre#82442)) AND (filter_pre#82443 = filter_0016048416)), Statistics(sizeInBytes=460.0 B, rowCount=2, [filter_pre#82443 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 17, maxLen: 17, histogram: N/A, version: 2), o_shippriority#82451 -> ColumnStat(distinctCount: 1, min: 0, max: 0, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), o_totalprice#82447 -> ColumnStat(distinctCount: 1, min: 836.28, max: 569370.40, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_orderpriority#82449 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 9, maxLen: 15, histogram: N/A, version: 2), orderkey_pre#82442 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), o_comment#82452 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 49, maxLen: 78, histogram: N/A, version: 2), o_orderstatus#82446 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), id#82453L -> ColumnStat(distinctCount: 1, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_custkey#82445L -> ColumnStat(distinctCount: 1, min: 1, max: 749999, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_orderkey#82444L -> ColumnStat(distinctCount: 1, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_orderdate#82448 -> ColumnStat(distinctCount: 1, min: 8035, max: 10440, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), o_clerk#82450 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 15, maxLen: 15, histogram: N/A, version: 2)])
-- MAGIC          +- Relation ml.default.orders_orig[orderkey_pre#82442,filter_pre#82443,o_orderkey#82444L,o_custkey#82445L,o_orderstatus#82446,o_totalprice#82447,o_orderdate#82448,o_orderpriority#82449,o_clerk#82450,o_shippriority#82451,o_comment#82452,id#82453L] parquet, Statistics(sizeInBytes=16.1 GiB, rowCount=7.50E+7, [filter_pre#82443 -> ColumnStat(distinctCount: 72374226, min: N/A, max: N/A, nullCount: 0, avgLen: 17, maxLen: 17, histogram: N/A, version: 2), o_shippriority#82451 -> ColumnStat(distinctCount: 1, min: 0, max: 0, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), o_totalprice#82447 -> ColumnStat(distinctCount: 6264859, min: 836.28, max: 569370.40, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_orderpriority#82449 -> ColumnStat(distinctCount: 5, min: N/A, max: N/A, nullCount: 0, avgLen: 9, maxLen: 15, histogram: N/A, version: 2), orderkey_pre#82442 -> ColumnStat(distinctCount: 75000000, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), o_comment#82452 -> ColumnStat(distinctCount: 6721767, min: N/A, max: N/A, nullCount: 0, avgLen: 49, maxLen: 78, histogram: N/A, version: 2), o_orderstatus#82446 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), id#82453L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_custkey#82445L -> ColumnStat(distinctCount: 496996, min: 1, max: 749999, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_orderkey#82444L -> ColumnStat(distinctCount: 7034375, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_orderdate#82448 -> ColumnStat(distinctCount: 2529, min: 8035, max: 10440, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), o_clerk#82450 -> ColumnStat(distinctCount: 4613, min: N/A, max: N/A, nullCount: 0, avgLen: 15, maxLen: 15, histogram: N/A, version: 2)])
-- MAGIC
-- MAGIC == Physical Plan ==
-- MAGIC AdaptiveSparkPlan isFinalPlan=false
-- MAGIC +- ColumnarToRow
-- MAGIC    +- PhotonResultStage
-- MAGIC       +- PhotonProject [orderkey_pre#82412, l_orderkey#82413L, l_partkey#82414L, l_suppkey#82415L, l_linenumber#82416, l_quantity#82417, l_extendedprice#82418, l_discount#82419, l_tax#82420, l_returnflag#82421, l_linestatus#82422, l_shipdate#82423, l_commitdate#82424, l_receiptdate#82425, l_shipinstruct#82426, l_shipmode#82427, l_comment#82428, id#82429L]
-- MAGIC          +- PhotonBroadcastHashJoin [orderkey_pre#82412], [orderkey_pre#82442], Inner, BuildRight, false, true
-- MAGIC             :- PhotonScan parquet ml.default.lineitem_orig[orderkey_pre#82412,l_orderkey#82413L,l_partkey#82414L,l_suppkey#82415L,l_linenumber#82416,l_quantity#82417,l_extendedprice#82418,l_discount#82419,l_tax#82420,l_returnflag#82421,l_linestatus#82422,l_shipdate#82423,l_commitdate#82424,l_receiptdate#82425,l_shipinstruct#82426,l_shipmode#82427,l_comment#82428,id#82429L] DataFilters: [isnotnull(orderkey_pre#82412), dynamicpruning#82457 82456], DictionaryFilters: [], Format: parquet, Location: PreparedDeltaFileIndex(1 paths)[s3://unity-catalogs-us-west-2/7cf139a0-c5bc-40c0-a0a7-63b7d495807..., OptionalDataFilters: [], PartitionFilters: [], ReadSchema: struct<orderkey_pre:string,l_orderkey:bigint,l_partkey:bigint,l_suppkey:bigint,l_linenumber:int,l..., RequiredDataFilters: [isnotnull(orderkey_pre#82412)]
-- MAGIC             +- PhotonShuffleExchangeSource
-- MAGIC                +- PhotonShuffleMapStage
-- MAGIC                   +- PhotonShuffleExchangeSink SinglePartition
-- MAGIC                      +- PhotonProject [orderkey_pre#82442]
-- MAGIC                         +- PhotonScan parquet ml.default.orders_orig[orderkey_pre#82442,filter_pre#82443] DataFilters: [isnotnull(filter_pre#82443), isnotnull(orderkey_pre#82442), (filter_pre#82443 = filter_0016048416)], DictionaryFilters: [(filter_pre#82443 = filter_0016048416)], Format: parquet, Location: PreparedDeltaFileIndex(1 paths)[s3://unity-catalogs-us-west-2/7cf139a0-c5bc-40c0-a0a7-63b7d495807..., OptionalDataFilters: [], PartitionFilters: [], ReadSchema: struct<orderkey_pre:string,filter_pre:string>, RequiredDataFilters: [isnotnull(filter_pre#82443), isnotnull(orderkey_pre#82442), (filter_pre#82443 = filter_0016048416)]
-- MAGIC
-- MAGIC ```

-- COMMAND ----------

create or replace table output_case3_2 as
  select A.* from lineitem_orig A
  where A.orderkey_pre in (select B.orderkey_pre from orders_orig B where B.filter_pre = "filter_0016048416")
;

-- COMMAND ----------

-- MAGIC %md
-- MAGIC 実行計画
-- MAGIC
-- MAGIC ```
-- MAGIC == Optimized Logical Plan ==
-- MAGIC Join LeftSemi, (orderkey_pre#82542 = orderkey_pre#82572), rightHint=(dynamicPruningFilterId=Some(82586)), Statistics(sizeInBytes=1800.0 B, rowCount=8, [l_linestatus#82552 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_quantity#82547 -> ColumnStat(distinctCount: 1, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipinstruct#82556 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_orderkey#82543L -> ColumnStat(distinctCount: 1, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipdate#82553 -> ColumnStat(distinctCount: 1, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_suppkey#82545L -> ColumnStat(distinctCount: 1, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_extendedprice#82548 -> ColumnStat(distinctCount: 1, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), id#82559L -> ColumnStat(distinctCount: 1, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_receiptdate#82555 -> ColumnStat(distinctCount: 1, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), orderkey_pre#82542 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_tax#82550 -> ColumnStat(distinctCount: 1, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_discount#82549 -> ColumnStat(distinctCount: 1, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_commitdate#82554 -> ColumnStat(distinctCount: 1, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_comment#82558 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), l_shipmode#82557 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), l_linenumber#82546 -> ColumnStat(distinctCount: 1, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_returnflag#82551 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_partkey#82544L -> ColumnStat(distinctCount: 1, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2)])
-- MAGIC :- Filter (isnotnull(orderkey_pre#82542) AND dynamicpruning#82587 82586), Statistics(sizeInBytes=62.9 GiB, rowCount=3.00E+8, [l_linestatus#82552 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_quantity#82547 -> ColumnStat(distinctCount: 48, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipinstruct#82556 -> ColumnStat(distinctCount: 4, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_orderkey#82543L -> ColumnStat(distinctCount: 7034375, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipdate#82553 -> ColumnStat(distinctCount: 2676, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_suppkey#82545L -> ColumnStat(distinctCount: 50113, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_extendedprice#82548 -> ColumnStat(distinctCount: 1106873, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), id#82559L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_receiptdate#82555 -> ColumnStat(distinctCount: 2721, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), orderkey_pre#82542 -> ColumnStat(distinctCount: 77489466, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_tax#82550 -> ColumnStat(distinctCount: 9, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_discount#82549 -> ColumnStat(distinctCount: 11, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_commitdate#82554 -> ColumnStat(distinctCount: 2615, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_comment#82558 -> ColumnStat(distinctCount: 18316269, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), l_shipmode#82557 -> ColumnStat(distinctCount: 7, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), l_linenumber#82546 -> ColumnStat(distinctCount: 7, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_returnflag#82551 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_partkey#82544L -> ColumnStat(distinctCount: 925738, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2)])
-- MAGIC :  +- Relation ml.default.lineitem_orig[orderkey_pre#82542,l_orderkey#82543L,l_partkey#82544L,l_suppkey#82545L,l_linenumber#82546,l_quantity#82547,l_extendedprice#82548,l_discount#82549,l_tax#82550,l_returnflag#82551,l_linestatus#82552,l_shipdate#82553,l_commitdate#82554,l_receiptdate#82555,l_shipinstruct#82556,l_shipmode#82557,l_comment#82558,id#82559L] parquet, Statistics(sizeInBytes=62.9 GiB, rowCount=3.00E+8, [l_linestatus#82552 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_quantity#82547 -> ColumnStat(distinctCount: 48, min: 1.00, max: 50.00, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipinstruct#82556 -> ColumnStat(distinctCount: 4, min: N/A, max: N/A, nullCount: 0, avgLen: 12, maxLen: 17, histogram: N/A, version: 2), l_orderkey#82543L -> ColumnStat(distinctCount: 7034375, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_shipdate#82553 -> ColumnStat(distinctCount: 2676, min: 8036, max: 10561, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_suppkey#82545L -> ColumnStat(distinctCount: 50113, min: 1, max: 50000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_extendedprice#82548 -> ColumnStat(distinctCount: 1106873, min: 900.99, max: 104949.50, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), id#82559L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_receiptdate#82555 -> ColumnStat(distinctCount: 2721, min: 8037, max: 10591, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), orderkey_pre#82542 -> ColumnStat(distinctCount: 77489466, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2), l_tax#82550 -> ColumnStat(distinctCount: 9, min: 0.00, max: 0.08, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_discount#82549 -> ColumnStat(distinctCount: 11, min: 0.00, max: 0.10, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), l_commitdate#82554 -> ColumnStat(distinctCount: 2615, min: 8065, max: 10530, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_comment#82558 -> ColumnStat(distinctCount: 18316269, min: N/A, max: N/A, nullCount: 0, avgLen: 27, maxLen: 43, histogram: N/A, version: 2), l_shipmode#82557 -> ColumnStat(distinctCount: 7, min: N/A, max: N/A, nullCount: 0, avgLen: 5, maxLen: 7, histogram: N/A, version: 2), l_linenumber#82546 -> ColumnStat(distinctCount: 7, min: 1, max: 7, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), l_returnflag#82551 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), l_partkey#82544L -> ColumnStat(distinctCount: 925738, min: 1, max: 1000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2)])
-- MAGIC +- Project [orderkey_pre#82572], Statistics(sizeInBytes=78.0 B, rowCount=2, [orderkey_pre#82572 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2)])
-- MAGIC    +- Filter ((isnotnull(filter_pre#82573) AND (filter_pre#82573 = filter_0016048416)) AND isnotnull(orderkey_pre#82572)), Statistics(sizeInBytes=460.0 B, rowCount=2, [o_custkey#82575L -> ColumnStat(distinctCount: 1, min: 1, max: 749999, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_totalprice#82577 -> ColumnStat(distinctCount: 1, min: 836.28, max: 569370.40, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_clerk#82580 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 15, maxLen: 15, histogram: N/A, version: 2), o_orderkey#82574L -> ColumnStat(distinctCount: 1, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), filter_pre#82573 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 17, maxLen: 17, histogram: N/A, version: 2), o_comment#82582 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 49, maxLen: 78, histogram: N/A, version: 2), o_shippriority#82581 -> ColumnStat(distinctCount: 1, min: 0, max: 0, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), o_orderdate#82578 -> ColumnStat(distinctCount: 1, min: 8035, max: 10440, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), id#82583L -> ColumnStat(distinctCount: 1, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_orderstatus#82576 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), o_orderpriority#82579 -> ColumnStat(distinctCount: 1, min: N/A, max: N/A, nullCount: 0, avgLen: 9, maxLen: 15, histogram: N/A, version: 2), orderkey_pre#82572 -> ColumnStat(distinctCount: 2, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2)])
-- MAGIC       +- Relation ml.default.orders_orig[orderkey_pre#82572,filter_pre#82573,o_orderkey#82574L,o_custkey#82575L,o_orderstatus#82576,o_totalprice#82577,o_orderdate#82578,o_orderpriority#82579,o_clerk#82580,o_shippriority#82581,o_comment#82582,id#82583L] parquet, Statistics(sizeInBytes=16.1 GiB, rowCount=7.50E+7, [o_custkey#82575L -> ColumnStat(distinctCount: 496996, min: 1, max: 749999, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_totalprice#82577 -> ColumnStat(distinctCount: 6264859, min: 836.28, max: 569370.40, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_clerk#82580 -> ColumnStat(distinctCount: 4613, min: N/A, max: N/A, nullCount: 0, avgLen: 15, maxLen: 15, histogram: N/A, version: 2), o_orderkey#82574L -> ColumnStat(distinctCount: 7034375, min: 1, max: 30000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), filter_pre#82573 -> ColumnStat(distinctCount: 72374226, min: N/A, max: N/A, nullCount: 0, avgLen: 17, maxLen: 17, histogram: N/A, version: 2), o_comment#82582 -> ColumnStat(distinctCount: 6721767, min: N/A, max: N/A, nullCount: 0, avgLen: 49, maxLen: 78, histogram: N/A, version: 2), o_shippriority#82581 -> ColumnStat(distinctCount: 1, min: 0, max: 0, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), o_orderdate#82578 -> ColumnStat(distinctCount: 2529, min: 8035, max: 10440, nullCount: 0, avgLen: 4, maxLen: 4, histogram: N/A, version: 2), id#82583L -> ColumnStat(distinctCount: 10, min: 0, max: 900000000, nullCount: 0, avgLen: 8, maxLen: 8, histogram: N/A, version: 2), o_orderstatus#82576 -> ColumnStat(distinctCount: 3, min: N/A, max: N/A, nullCount: 0, avgLen: 1, maxLen: 1, histogram: N/A, version: 2), o_orderpriority#82579 -> ColumnStat(distinctCount: 5, min: N/A, max: N/A, nullCount: 0, avgLen: 9, maxLen: 15, histogram: N/A, version: 2), orderkey_pre#82572 -> ColumnStat(distinctCount: 75000000, min: N/A, max: N/A, nullCount: 0, avgLen: 19, maxLen: 19, histogram: N/A, version: 2)])
-- MAGIC
-- MAGIC == Physical Plan ==
-- MAGIC AdaptiveSparkPlan isFinalPlan=false
-- MAGIC +- ColumnarToRow
-- MAGIC    +- PhotonResultStage
-- MAGIC       +- PhotonBroadcastHashJoin [orderkey_pre#82542], [orderkey_pre#82572], LeftSemi, BuildRight, false, true
-- MAGIC          :- PhotonScan parquet ml.default.lineitem_orig[orderkey_pre#82542,l_orderkey#82543L,l_partkey#82544L,l_suppkey#82545L,l_linenumber#82546,l_quantity#82547,l_extendedprice#82548,l_discount#82549,l_tax#82550,l_returnflag#82551,l_linestatus#82552,l_shipdate#82553,l_commitdate#82554,l_receiptdate#82555,l_shipinstruct#82556,l_shipmode#82557,l_comment#82558,id#82559L] DataFilters: [isnotnull(orderkey_pre#82542), dynamicpruning#82587 82586], DictionaryFilters: [], Format: parquet, Location: PreparedDeltaFileIndex(1 paths)[s3://unity-catalogs-us-west-2/7cf139a0-c5bc-40c0-a0a7-63b7d495807..., OptionalDataFilters: [], PartitionFilters: [], ReadSchema: struct<orderkey_pre:string,l_orderkey:bigint,l_partkey:bigint,l_suppkey:bigint,l_linenumber:int,l..., RequiredDataFilters: [isnotnull(orderkey_pre#82542)]
-- MAGIC          +- PhotonShuffleExchangeSource
-- MAGIC             +- PhotonShuffleMapStage
-- MAGIC                +- PhotonShuffleExchangeSink SinglePartition
-- MAGIC                   +- PhotonProject [orderkey_pre#82572]
-- MAGIC                      +- PhotonScan parquet ml.default.orders_orig[orderkey_pre#82572,filter_pre#82573] DataFilters: [isnotnull(filter_pre#82573), (filter_pre#82573 = filter_0016048416), isnotnull(orderkey_pre#82572)], DictionaryFilters: [(filter_pre#82573 = filter_0016048416)], Format: parquet, Location: PreparedDeltaFileIndex(1 paths)[s3://unity-catalogs-us-west-2/7cf139a0-c5bc-40c0-a0a7-63b7d495807..., OptionalDataFilters: [], PartitionFilters: [], ReadSchema: struct<orderkey_pre:string,filter_pre:string>, RequiredDataFilters: [isnotnull(filter_pre#82573), (filter_pre#82573 = filter_0016048416), isnotnull(orderkey_pre#82572)]
-- MAGIC
-- MAGIC ```
